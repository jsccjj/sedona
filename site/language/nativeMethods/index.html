



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Online documentation for Sedona Framework(R)">
      
      
        <link rel="canonical" href="https://linsong.github.io/sedona/language/nativeMethods/">
      
      
        <meta name="author" content="Sedona Community">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>Native Methods - Sedona Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#795548">
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="brown" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#native-methods" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://linsong.github.io/sedona" title="Sedona Documentation" aria-label="Sedona Documentation" class="md-header-nav__button md-logo">
          
            <img alt="logo" src="../../favicon.ico" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Sedona Documentation
            </span>
            <span class="md-header-nav__topic">
              
                Native Methods
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/linsong/sedona/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    linsong/sedona
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://linsong.github.io/sedona" title="Sedona Documentation" class="md-nav__button md-logo">
      
        <img alt="logo" src="../../favicon.ico" width="48" height="48">
      
    </a>
    Sedona Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/linsong/sedona/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    linsong/sedona
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Index" class="md-nav__link">
      Index
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../quickstart/intro/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../quickstart/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../quickstart/architecture/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../quickstart/tutorial/" title="Tutorial" class="md-nav__link">
      Tutorial
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Language
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Language
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../lang/" title="Language" class="md-nav__link">
      Language
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../primitives/" title="Primitives" class="md-nav__link">
      Primitives
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../expr/" title="Expressions" class="md-nav__link">
      Expressions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../stmt/" title="Statements" class="md-nav__link">
      Statements
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../classes/" title="Classes" class="md-nav__link">
      Classes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fields/" title="Fields" class="md-nav__link">
      Fields
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../methods/" title="Methods" class="md-nav__link">
      Methods
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../components/" title="Components" class="md-nav__link">
      Components
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../reflection/" title="Reflection" class="md-nav__link">
      Reflection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../arrays/" title="Arrays" class="md-nav__link">
      Arrays
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../memory/" title="Memory" class="md-nav__link">
      Memory
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Native Methods
      </label>
    
    <a href="./" title="Native Methods" class="md-nav__link md-nav__link--active">
      Native Methods
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#native-id" class="md-nav__link">
    Native Id
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stubs" class="md-nav__link">
    Stubs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#native-implementation" class="md-nav__link">
    Native Implementation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#native-tables" class="md-nav__link">
    Native Tables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-issues" class="md-nav__link">
    Additional Issues
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#predefined-kit-ids" class="md-nav__link">
    Predefined Kit Ids
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../logging/" title="Logging" class="md-nav__link">
      Logging
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Apps
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Apps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../apps/apps/" title="Application Model" class="md-nav__link">
      Application Model
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../apps/security/" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Deployment
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Deployment
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../deployment/kits/" title="Kits" class="md-nav__link">
      Kits
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deployment/schema/" title="Schema" class="md-nav__link">
      Schema
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Platforms
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Platforms
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../platforms/platDef/" title="Platform Definition" class="md-nav__link">
      Platform Definition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../platforms/par/" title="Platform Archive" class="md-nav__link">
      Platform Archive
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../platforms/platTutorial/" title="Platform Tutorial" class="md-nav__link">
      Platform Tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../platforms/deviceSim/" title="Device Simulator" class="md-nav__link">
      Device Simulator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../platforms/platCertified/" title="Certified Platforms" class="md-nav__link">
      Certified Platforms
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/sedonac/" title="Sedonac" class="md-nav__link">
      Sedonac
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/testing/" title="Testing" class="md-nav__link">
      Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/porting/" title="Porting" class="md-nav__link">
      Porting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/niagara/" title="Niagara" class="md-nav__link">
      Niagara
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Networking
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Networking
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../networking/networking/" title="Networking" class="md-nav__link">
      Networking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../networking/dasp/" title="DASP" class="md-nav__link">
      DASP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../networking/sox/" title="Sox" class="md-nav__link">
      Sox
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../networking/discover/" title="Device Discovery" class="md-nav__link">
      Device Discovery
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Appendix
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Appendix
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendix/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendix/conventions/" title="Coding Conventions" class="md-nav__link">
      Coding Conventions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendix/scodeFormat/" title="SCode Format" class="md-nav__link">
      SCode Format
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendix/grammar/" title="Grammar" class="md-nav__link">
      Grammar
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Releases
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Releases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../releases/newFor12/" title="v1.2" class="md-nav__link">
      v1.2
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../api/api/" title="API" class="md-nav__link">
      API
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#native-id" class="md-nav__link">
    Native Id
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stubs" class="md-nav__link">
    Stubs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#native-implementation" class="md-nav__link">
    Native Implementation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#native-tables" class="md-nav__link">
    Native Tables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-issues" class="md-nav__link">
    Additional Issues
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#predefined-kit-ids" class="md-nav__link">
    Predefined Kit Ids
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/linsong/sedona/edit/master/docs/language/nativeMethods.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <!--
[//]: # (Copyright &#169; 2007 Tridium, Inc
  Licensed under the Academic Free License version 3.0

  History:
    29 Mar 07  Brian Frank  Creation
) -->

<p><a href="/"><img alt="Sedona" src="../../logo.png" /></a></p>
<h1 id="native-methods">Native Methods<a class="headerlink" href="#native-methods" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>Native methods are used to create Sedona APIs that bind to native code
written in the C programming language. The following steps are used to
create a native method:</p>
<ol>
<li><strong>Native Id</strong>: Every native method is assigned a unique two byte
    identifier in the kit's <code>kit.xml</code> file</li>
<li><strong>Stub</strong>: Every native method is declared in the Sedona code using
    the <code>native</code> modifier</li>
<li><strong>Native Implementation</strong>: Native methods are implemented as
    functions in the C programming language</li>
<li><strong>Native Tables</strong>: At staging, function pointers to the native
    implementations are mapped into tables for dispatch by the SVM at
    runtime</li>
</ol>
<h2 id="native-id">Native Id<a class="headerlink" href="#native-id" title="Permanent link">&para;</a></h2>
<p>Every native method is assigned a two byte identifier used to dispatch a
call to the proper C function. The first byte is the <em>kitId</em> and the
second byte is the <em>methodId</em>. Native ids are expressed as
"kitId::methodId".</p>
<p>Each kit that contains native methods should be assigned a unique kitId.
Technically kitIds don't need to be globally unique, but they must be
unique across all the kits that might be used together for a given
platform. The range of kitIds from 0 to 99 is reserved for core Sedona
Framework kits. Third parties should use kitIds from 100 to 255 (or
contact the Sedona Framework development team). The <code>sys</code> kit itself is
assigned the kitId of zero. Any <a href="/platforms/platTutorial">platform service</a>
kit (i.e. a platform-specific kit containing a PlatformService subclass)
can be given a kitId of 1, since there will never be more than one such
kit loaded on a Sedona device at any given time.</p>
<p>Within a kit, every native method is assigned a unique methodId. Because
the methodId is only a byte, there can be at most 255 native methods in
a single kit.</p>
<p>The list of native ids for a kit is defined in the <code>kit.xml</code> file using
the following XML format:</p>
<div class="codehilite"><pre><span></span><code>    <span class="nt">&lt;natives&gt;</span>
      <span class="nt">&lt;native</span> <span class="na">qname=</span><span class="s">&quot;foo::Type1.method1&quot;</span> <span class="na">id=</span><span class="s">&quot;6::0&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;native</span> <span class="na">qname=</span><span class="s">&quot;foo::Type1.method2&quot;</span> <span class="na">id=</span><span class="s">&quot;6::1&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;native</span> <span class="na">qname=</span><span class="s">&quot;foo::Type2.method1&quot;</span> <span class="na">id=</span><span class="s">&quot;6::2&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/natives&gt;</span>
</code></pre></div>

<p>The <code>natives</code> element contains one or more <code>native</code> elements for each
native method in the kit. The <code>native</code> element contains two required
attributes: <code>qname</code> specifies the qualified name of the native method
and <code>id</code> specifies the native id formatted as "kitId::methodId". In
this example, the kitId for kit <code>foo</code> is 6, and the native method
methodIds are 0, 1, and 2.</p>
<h2 id="stubs">Stubs<a class="headerlink" href="#stubs" title="Permanent link">&para;</a></h2>
<p>Native methods are declared like normal methods but without a method
body (just like abstract methods). Native methods must be flagged with
the <code>native</code> keyword. Native methods cannot be <code>abstract</code> or <code>virtual</code>.
For example:</p>
<div class="codehilite"><pre><span></span><code>class Type2
{
  static native int add(int a, int b)
  static native void test(bool z, int i, float f)
  native float  testf(int i, float f)
}
</code></pre></div>


<p>The compiler will perform a series of checks upon the native ids and
native stubs when compiling source code into a kit file (in the
<code>ResolveNatives</code> step). Unless errors are detected, the native ids are
written into the appropriate IR files of the kit. If any native ids are
modified, you must recompile from source.</p>
<h2 id="native-implementation">Native Implementation<a class="headerlink" href="#native-implementation" title="Permanent link">&para;</a></h2>
<p>The SVM is stack based. Each item on the stack is called a <em>Cell</em>, which
is a union of <code>int32_t</code>, <code>float</code>, and <code>void*</code>. Unless you are running on
a 64-bit processor, a Cell is 32-bits wide. The definition of Cell in
<code>sedona.h</code> is:</p>
<div class="codehilite"><pre><span></span><code>typedef union
{
  int32_t ival;    // 32-bit signed int
  float   fval;    // 32-bit float
  void*   aval;    // address pointer
}
Cell;
</code></pre></div>


<p>Every native method must be implemented in C as a function that takes
two arguments: a <code>SedonaVM_s</code> pointer and a <code>Cell</code> pointer into the
stack, and returns a <code>Cell</code>. (Native methods that return a <code>long</code> or a
<code>double</code> require special handling, described in more detail below). The
definition for SedonaVM_s is in <code>sedona.h</code>. The typedef for a native
method pointer is:</p>
<div class="codehilite"><pre><span></span><code>typedef Cell (*NativeMethod)(struct SedonaVM_s* vm, Cell* params);
</code></pre></div>


<p>The method parameters are accessed from the stack via the Cell pointer
<code>params</code>. You can manually extract the individual parameters using array
indexing. If the native method is not static, then parameter 0 is always
the implicit <code>this</code> pointer.</p>
<p>It is important to note that all native method implementations return a
Cell value even when the Sedona signature for the method returns <code>void</code>.
You can use the constant <code>nullCell</code> to return from a method that returns
<code>void</code>. Other predefined Cell constants are <code>trueCell</code>, <code>falseCell</code>,
<code>zeroCell</code>, <code>oneCell</code>, and <code>negOneCell</code>.</p>
<p>An example implementation of the <code>foo::Type2.add</code> method:
<div class="codehilite"><pre><span></span><code>    <span class="n">Cell</span> <span class="nf">foo_Type2_add</span><span class="p">(</span><span class="n">SedonaVM</span><span class="o">*</span> <span class="n">vm</span><span class="p">,</span> <span class="n">Cell</span><span class="o">*</span> <span class="n">params</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="kt">int32_t</span> <span class="n">a</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ival</span><span class="p">;</span>
      <span class="kt">int32_t</span> <span class="n">b</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ival</span><span class="p">;</span>
      <span class="n">Cell</span> <span class="n">result</span><span class="p">;</span>

      <span class="n">result</span><span class="p">.</span><span class="n">ival</span> <span class="o">=</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">;</span>

      <span class="k">return</span> <span class="n">result</span>
    <span class="p">}</span>
</code></pre></div>
An example implementation of the <code>foo::Type2.test</code> method:
<div class="codehilite"><pre><span></span><code>    <span class="n">Cell</span> <span class="nf">foo_Type2_test</span><span class="p">(</span><span class="n">SedonaVM</span><span class="o">*</span> <span class="n">vm</span><span class="p">,</span> <span class="n">Cell</span><span class="o">*</span> <span class="n">params</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="kt">int32_t</span> <span class="n">z</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ival</span><span class="p">;</span>
      <span class="kt">int32_t</span> <span class="n">b</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ival</span><span class="p">;</span>
      <span class="kt">float</span>   <span class="n">f</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">fval</span><span class="p">;</span>

      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;test %d %d %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>

      <span class="k">return</span> <span class="n">nullCell</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div>
An example implementation of the (non-static) <code>foo::Type2.testf</code> method:
<div class="codehilite"><pre><span></span><code>    <span class="n">Cell</span> <span class="nf">foo_Type2_testf</span><span class="p">(</span><span class="n">SedonaVM</span><span class="o">*</span> <span class="n">vm</span><span class="p">,</span> <span class="n">Cell</span><span class="o">*</span> <span class="n">params</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="kt">void</span><span class="o">*</span> <span class="k">this</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">aval</span><span class="p">;</span>   <span class="cm">/* &#39;this&#39; pointer is implicit first element of params[] */</span>
      <span class="kt">int32_t</span> <span class="n">b</span>  <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ival</span><span class="p">;</span>
      <span class="kt">float</span>   <span class="n">f</span>  <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">fval</span><span class="p">;</span>
      <span class="n">Cell</span> <span class="n">result</span><span class="p">;</span>

      <span class="n">result</span><span class="p">.</span><span class="n">fval</span> <span class="o">=</span> <span class="n">b</span><span class="o">*</span><span class="n">f</span><span class="p">;</span>

      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;test %d*%f=%f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">fval</span><span class="p">);</span>

      <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div>
Note in the examples above how each parameter is extracted using array
indexing and the union member name. Pointers (including strings) should
use the <code>aval</code> member, <code>floats</code> the <code>fval</code> member, and all other
primitives are accessed using the <code>ival</code> member. Note that a Sedona
<code>bool</code> maps into zero and non-zero for <code>false</code> and <code>true</code> respectively.
Arrays of primitives are accessed like their C counterparts.</p>
<p>Native methods that pass or return <code>long</code> or <code>double</code> are a bit
trickier. A single <code>long</code> or <code>double</code> value requires two Cells to store
the full 64-bits. To access a <code>long</code> or <code>double</code> function argument
requires the use of pointer casting to access two consecutive elements
of the parameter array. A native method that returns a <code>long</code> or
<code>double</code> should declare the return type to be <code>int64_t</code> instead of
<code>Cell</code>. The following is an example - note how each <code>long</code> parameter
actually consumes two cells of the parameter list:
<div class="codehilite"><pre><span></span><code>    <span class="n">native</span> <span class="k">static</span> <span class="kt">long</span> <span class="nf">addTwoLongs</span><span class="p">(</span><span class="kt">long</span> <span class="n">a</span><span class="p">,</span> <span class="kt">long</span> <span class="n">b</span><span class="p">)</span>

    <span class="kt">int64_t</span> <span class="n">foo_Type3_addTwoLongs</span><span class="p">(</span><span class="n">SedonaVM</span><span class="o">*</span> <span class="n">vm</span><span class="p">,</span> <span class="n">Cell</span><span class="o">*</span> <span class="n">params</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="kt">int64_t</span> <span class="n">a</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">int64_t</span><span class="o">*</span><span class="p">)(</span><span class="n">params</span><span class="o">+</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// param 0+1</span>
      <span class="kt">int64_t</span> <span class="n">b</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">int64_t</span><span class="o">*</span><span class="p">)(</span><span class="n">params</span><span class="o">+</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// param 2+3</span>
      <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div>
A summary of common mappings from Sedona to their C equivalents:</p>
<table>
<thead>
<tr>
<th>Sedona</th>
<th>C</th>
<th></th>
<th>Sedona</th>
<th>C</th>
</tr>
</thead>
<tbody>
<tr>
<td>bool</td>
<td>int32_t</td>
<td></td>
<td>bool[]</td>
<td>uint8_t*</td>
</tr>
<tr>
<td>byte</td>
<td>int32_t</td>
<td></td>
<td>byte[]</td>
<td>uint8_t*</td>
</tr>
<tr>
<td>short</td>
<td>int32_t</td>
<td></td>
<td>short[]</td>
<td>uint16_t*</td>
</tr>
<tr>
<td>int</td>
<td>int32_t</td>
<td></td>
<td>int[]</td>
<td>int32_t*</td>
</tr>
<tr>
<td>long</td>
<td>int64_t</td>
<td></td>
<td>long[]</td>
<td>int64_t*</td>
</tr>
<tr>
<td>float</td>
<td>float</td>
<td></td>
<td>float[]</td>
<td>float*</td>
</tr>
<tr>
<td>double</td>
<td>double</td>
<td></td>
<td>double[]</td>
<td>double*</td>
</tr>
<tr>
<td>Obj</td>
<td>void*</td>
<td></td>
<td>Obj[]</td>
<td>void**</td>
</tr>
<tr>
<td>Str</td>
<td>uint8_t*</td>
<td></td>
<td>Str[]</td>
<td>uint8_t**</td>
</tr>
</tbody>
</table>
<p>Note that strings can be used as a normal null terminated C string.</p>
<p>Refer to the <a href="/development/porting#natives">Porting</a> chapter for how to
structure your native C code.</p>
<h2 id="native-tables">Native Tables<a class="headerlink" href="#native-tables" title="Permanent link">&para;</a></h2>
<p>When the SVM is compiled, the SVM is bound to a lookup table for all the
native methods available. This lookup table is a two level array of
function pointers. The first level of the array maps to the kitIds and
the second level maps to the methodIds. For example the function pointer
for the native id of "2::7" would be <code>nativeTable[2][7]</code>.</p>
<p>The native lookup table is automatically generated as "nativetable.c"
when <code>sedonac</code> is used to <a href="/development/porting#staging">stage a VM</a>.</p>
<h2 id="additional-issues">Additional Issues<a class="headerlink" href="#additional-issues" title="Permanent link">&para;</a></h2>
<p>The existing native method facility provides low level hooks to bind
Sedona Framework APIs into the native platform. However due to its low
level nature it maps fairly closely to the stack architecture of the VM.
This design has the major limitation that it only works well when
accessing primitives off the stack. There is currently no safe mechanism
to access individual fields of an Object within a native method, as you
would need to know exactly how the compiler will layout the memory (even
then it would be quite brittle). In the meantime the best practice is to
pass only primitives (or arrays of primitives) as parameters.</p>
<h2 id="predefined-kit-ids">Predefined Kit Ids<a class="headerlink" href="#predefined-kit-ids" title="Permanent link">&para;</a></h2>
<p>The following table shows some of the currently predefined native kit
ids. All PlatformService kits use a native kit id of 1.</p>
<table>
<thead>
<tr>
<th>Kit</th>
<th>Id</th>
</tr>
</thead>
<tbody>
<tr>
<td>sys</td>
<td>0</td>
</tr>
<tr>
<td><em>platform svcs</em></td>
<td>1</td>
</tr>
<tr>
<td>inet</td>
<td>2</td>
</tr>
<tr>
<td>serial</td>
<td>3</td>
</tr>
<tr>
<td>basicio</td>
<td>4</td>
</tr>
<tr>
<td>bacnet</td>
<td>5</td>
</tr>
<tr>
<td>smbus</td>
<td>6</td>
</tr>
<tr>
<td>spibus</td>
<td>7</td>
</tr>
<tr>
<td>nrio</td>
<td>8</td>
</tr>
<tr>
<td>datetimeStd</td>
<td>9</td>
</tr>
</tbody>
</table>
                
                  
                
                
                  
                  <hr>
                  <div class="md-source-date">
                    <small>
                      
                        Last update: April 7, 2020
                      
                    </small>
                  </div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../memory/" title="Memory" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Memory
              </span>
            </div>
          </a>
        
        
          <a href="../logging/" title="Logging" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Logging
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2007-2017 Tridium, 2018-2020 Sedona Community
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:"../.."}})</script>
      
    
  </body>
</html>